/**
 * (Manage)Sieve Filters plugin
 *
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this file.
 *
 * Copyright (c) 2012-2014, The Roundcube Dev Team
 *
 * The JavaScript code in this page is free software: you can redistribute it
 * and/or modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation, either version 3 of
 * the License, or (at your option) any later version.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in this file.
 */
function rule_header_select(e){var t=document.getElementById("header"+e),i=document.getElementById("rule_size"+e),a=document.getElementById("rule_op"+e),s=document.getElementById("custom_header"+e+"_list"),n=document.getElementById("rule_mod"+e),r=document.getElementById("rule_trans"+e),l=document.getElementById("rule_comp"+e),o=document.getElementById("rule_date_part"+e),c=document.getElementById("rule_date_header_div"+e),d=t.value;"size"==d?(i.style.display="inline",$.each([a,s,n,r,l],function(){this.style.display="none"})):(s.style.display="..."!=d?"none":"inline-block",i.style.display="none",a.style.display="inline",l.style.display="",n.style.display="body"==d||"currentdate"==d||"date"==d?"none":"block",r.style.display="body"==d?"block":"none"),o&&(o.style.display="currentdate"==d||"date"==d?"inline":"none"),c&&(c.style.display="date"==d?"":"none"),rule_op_select(a,e,d),rule_mod_select(e,d),t.style.width="..."==d?"40px":""}function rule_op_select(e,t,i){var a=document.getElementById("rule_target"+t+"_list");i||(i=document.getElementById("header"+t).value),a.style.display="exists"==e.value||"notexists"==e.value||"size"==i?"none":"inline-block"}function rule_trans_select(e){var t=document.getElementById("rule_trans_op"+e),i=document.getElementById("rule_trans_type"+e);i.style.display="content"!=t.value?"none":"inline"}function rule_mod_select(e,t){var i=document.getElementById("rule_mod_op"+e),a=document.getElementById("rule_mod_type"+e),s=document.getElementById("rule_index_div"+e);t||(t=document.getElementById("header"+e).value),a.style.display="address"!=i.value&&"envelope"!=i.value?"none":"inline",s&&(s.style.display="body"!=t&&"currentdate"!=t&&"size"!=t&&"envelope"!=i.value?"":"none")}function rule_join_radio(e){$("#rules").css("display","any"==e?"none":"block")}function rule_adv_switch(e,t){var t=$(t),i=t.hasClass("hide"),a=$("#rule_advanced"+e);i?(a.hide(),t.removeClass("hide").addClass("show")):(a.show(),t.removeClass("show").addClass("hide"))}function action_type_select(e){var t=document.getElementById("action_type"+e),i=t.value,a={},s={mailbox:document.getElementById("action_mailbox"+e),target:document.getElementById("redirect_target"+e),target_area:document.getElementById("action_target_area"+e),flags:document.getElementById("action_flags"+e),vacation:document.getElementById("action_vacation"+e),set:document.getElementById("action_set"+e),notify:document.getElementById("action_notify"+e)};"fileinto"==i||"fileinto_copy"==i?a.mailbox=1:"redirect"==i||"redirect_copy"==i?a.target=1:i.match(/^reject|ereject$/)?a.target_area=1:i.match(/^(add|set|remove)flag$/)?a.flags=1:"vacation"==i?a.vacation=1:"set"==i?a.set=1:"notify"==i&&(a.notify=1);for(var n in s)s[n].style.display=a[n]?"inline":"none"}function vacation_action_select(){var e=$("#vacation_action").val();$("#action_target_span")["discard"==e||"keep"==e?"hide":"show"]()}function smart_field_init(e){var t=e.id+"_list",i=$('<span class="listarea"></span>'),a=e.value?e.value.split("\n"):[""];$("#"+t).length||($.each(a,function(t,a){i.append(smart_field_row(a,e.name,t,$(e).data("size")))}),i.attr("id",t),e=$(e),e.attr("disabled")?i.hide():e.prop("disabled",!0),e.after(i),e.hasClass("error")&&(i.addClass("error"),rcmail.managesieve_tip_register([[t,e.data("tip")]])))}function smart_field_row(e,t,i,a){var s,n='<span class="listelement"><span class="reset"></span><input type="text"><span class="add"></span></span>',r=$(n),l={value:e,name:t+"[]"};return a&&(l.size=a),s=$("input",r).attr(l).keydown(function(e){var t=$(this);if(13==e.which){var i=t.attr("name").replace(/\[\]$/,""),s=(new Date).getTime(),n=smart_field_row("",i,s,a);t.parent().after(n),$("input",n).focus()}else if((8==e.which||46==e.which)&&""==t.val()){var r=t.parent(),l=r.parent().children();if(l.length>1)return r.prev().length?r.prev().children("input").focus():r.next().children("input").focus(),r.remove(),!1}}),$('span[class="reset"]',r).click(function(){var e=$(this.parentNode);e.parent().children().length>1?e.remove():$("input",e).val("").focus()}),$('span[class="add"]',r).click(function(){$(this.parentNode).parent().append(smart_field_row("",$(this.parentNode).find("input").attr("name").replace("[]",""),null,$(this.parentNode).find("input").attr("size")))}),r}function smart_field_reset(e,t){var i=e.id+"_list",a=t.length?t:[""];area=$("#"+i),area.empty(),$.each(a,function(t,i){area.append(smart_field_row(i,e.name,t,$(e).data("size")))})}function sieve_formattime(e,t){var i,a,s,n="",r=rcmail.env.time_format||"H:i";for(i=0;i<r.length;i++)switch(a=r.charAt(i)){case"a":n+=e>12?"am":"pm";break;case"A":n+=e>12?"AM":"PM";break;case"g":case"h":s=0==e?12:e>12?e-12:e,n+=("h"==a&&10>e?"0":"")+e;break;case"G":n+=e;break;case"H":n+=(10>e?"0":"")+e;break;case"i":n+=(10>t?"0":"")+t;break;case"s":n+="00";default:n+=a}return n}function sieve_form_init(){$('select[name="_header[]"]',rcmail.gui_objects.sieveform).each(function(){"..."==this.value&&(this.style.width="40px")}),"plugin.managesieve"==rcmail.env.action&&"mail"==rcmail.env.task&&parent.rcmail.managesieve_dialog_resize(rcmail.gui_objects.sieveform),$('input[type="text"]:first',rcmail.gui_objects.sieveform).focus(),$('textarea[data-type="list"]',rcmail.gui_objects.sieveform).each(function(){smart_field_init(this)}),$.datepicker&&rcmail.env.date_format&&($.datepicker.setDefaults({dateFormat:rcmail.env.date_format,changeMonth:!0,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(e){$(this).focus().val(e)}}),$("input.datepicker").datepicker()),$("#vacation_timefrom, #vacation_timeto").attr("autocomplete","off").autocomplete({delay:100,minLength:1,source:function(e,t){var i,a=[];for(i=0;24>i;i++)a.push(sieve_formattime(i,0));return a.push(sieve_formattime(23,59)),t(a)},open:function(){var e=$(this),t=e.val(),i=e.autocomplete("widget").css("width","10em"),a=e.data("ui-autocomplete").menu;t&&t.length&&i.children().each(function(){var e=$(this);0==e.text().indexOf(t)&&a._scrollIntoView(e)})},select:function(e,t){return $(this).val(t.item.value),!1}}).click(function(){$(this).autocomplete("search",$(this).val()||" ")})}window.rcmail&&rcmail.addEventListener("init",function(){if("mail"==rcmail.env.task&&("show"!=rcmail.env.action?rcmail.env.message_commands.push("managesieve-create"):rcmail.enable_command("managesieve-create",!0)),("mail"==rcmail.env.task||rcmail.env.action.startsWith("plugin.managesieve"))&&(rcmail.env.framed||(rcmail.env.ms_tip_layer=$('<div id="managesieve-tip" class="popupmenu"></div>'),rcmail.env.ms_tip_layer.appendTo(document.body))),rcmail.register_command("plugin.managesieve-save",function(){rcmail.managesieve_save()}),rcmail.register_command("plugin.managesieve-act",function(){rcmail.managesieve_act()}),rcmail.register_command("plugin.managesieve-add",function(){rcmail.managesieve_add()}),rcmail.register_command("plugin.managesieve-del",function(){rcmail.managesieve_del()}),rcmail.register_command("plugin.managesieve-move",function(){rcmail.managesieve_move()}),rcmail.register_command("plugin.managesieve-setadd",function(){rcmail.managesieve_setadd()}),rcmail.register_command("plugin.managesieve-setdel",function(){rcmail.managesieve_setdel()}),rcmail.register_command("plugin.managesieve-setact",function(){rcmail.managesieve_setact()}),rcmail.register_command("plugin.managesieve-setget",function(){rcmail.managesieve_setget()}),rcmail.env.action.startsWith("plugin.managesieve")){rcmail.gui_objects.sieveform?(rcmail.enable_command("plugin.managesieve-save",!0),sieve_form_init()):rcmail.enable_command("plugin.managesieve-add","plugin.managesieve-setadd",!rcmail.env.sieveconnerror);var e,t=rcmail.env.currentset;rcmail.gui_objects.filterslist&&(rcmail.filters_list=new rcube_list_widget(rcmail.gui_objects.filterslist,{multiselect:!1,draggable:!0,keyboard:!0}),rcmail.filters_list.addEventListener("select",function(e){rcmail.managesieve_select(e)}).addEventListener("dragstart",function(e){rcmail.managesieve_dragstart(e)}).addEventListener("dragend",function(e){rcmail.managesieve_dragend(e)}).addEventListener("initrow",function(e){e.obj.onmouseover=function(){rcmail.managesieve_focus_filter(e)},e.obj.onmouseout=function(){rcmail.managesieve_unfocus_filter(e)}}).init()),rcmail.gui_objects.filtersetslist&&(rcmail.filtersets_list=new rcube_list_widget(rcmail.gui_objects.filtersetslist,{multiselect:!1,draggable:!1,keyboard:!0}),rcmail.filtersets_list.init().focus(),null!=t&&(t=rcmail.managesieve_setid(t),rcmail.filtersets_list.select(t)),rcmail.filtersets_list.addEventListener("select",function(e){rcmail.managesieve_setselect(e)}),e=rcmail.filtersets_list.rowcount,rcmail.enable_command("plugin.managesieve-set",!0),rcmail.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",e),rcmail.enable_command("plugin.managesieve-setdel",e>1),$("tr",rcmail.gui_objects.filtersetslist).each(function(e,t){rcmail.managesieve_fixdragend(t)}))}rcmail.gui_objects.sieveform&&rcmail.env.rule_disabled&&$("#disabled").attr("checked",!0)}),rcube_webmail.prototype.managesieve_add=function(){this.load_managesieveframe(),this.filters_list.clear_selection()},rcube_webmail.prototype.managesieve_del=function(){var e=this.filters_list.get_single_selection();if(confirm(this.get_label("managesieve.filterdeleteconfirm"))){var t=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=delete&_fid="+this.filters_list.rows[e].uid,t)}},rcube_webmail.prototype.managesieve_act=function(){var e=this.filters_list.get_single_selection(),t=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=act&_fid="+this.filters_list.rows[e].uid,t)},rcube_webmail.prototype.managesieve_select=function(e){var t=e.get_single_selection();null!=t&&this.load_managesieveframe(e.rows[t].uid)},rcube_webmail.prototype.managesieve_setselect=function(e){this.show_contentframe(!1),this.filters_list.clear(!0),this.enable_command("plugin.managesieve-setdel",e.rowcount>1),this.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",!0);var t=e.get_single_selection();null!=t&&this.managesieve_list(this.env.filtersets[t])},rcube_webmail.prototype.managesieve_rowid=function(e){var t,i=this.filters_list.rows;for(t in i)if(null!=i[t]&&i[t].uid==e)return t},rcube_webmail.prototype.managesieve_setid=function(e){for(var t in this.env.filtersets)if(this.env.filtersets[t]==e)return t},rcube_webmail.prototype.managesieve_list=function(e){var t=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=list&_set="+urlencode(e),t)},rcube_webmail.prototype.managesieve_setget=function(){var e=this.filtersets_list.get_single_selection(),t=this.env.filtersets[e];location.href=this.env.comm_path+"&_action=plugin.managesieve-action&_act=setget&_set="+urlencode(t)},rcube_webmail.prototype.managesieve_setact=function(){var e=this.filtersets_list.get_single_selection(),t=this.set_busy(!0,"loading"),i=this.env.filtersets[e],a=$("#rcmrow"+e).hasClass("disabled")?"setact":"deact";this.http_post("plugin.managesieve-action","_act="+a+"&_set="+urlencode(i),t)},rcube_webmail.prototype.managesieve_setdel=function(){if(!confirm(this.get_label("managesieve.setdeleteconfirm")))return!1;var e=this.filtersets_list.get_single_selection(),t=this.set_busy(!0,"loading"),i=this.env.filtersets[e];this.http_post("plugin.managesieve-action","_act=setdel&_set="+urlencode(i),t)},rcube_webmail.prototype.managesieve_setadd=function(){if(this.filters_list.clear_selection(),this.enable_command("plugin.managesieve-act","plugin.managesieve-del",!1),this.env.contentframe&&window.frames&&window.frames[this.env.contentframe]){var e=this.set_busy(!0,"loading");target=window.frames[this.env.contentframe],target.location.href=this.env.comm_path+"&_action=plugin.managesieve-action&_framed=1&_newset=1&_unlock="+e}},rcube_webmail.prototype.managesieve_updatelist=function(e,t){switch(this.set_busy(!0),e){case"del":var i=t.id,a=this.filters_list;a.remove_row(this.managesieve_rowid(t.id)),a.clear_selection(),this.show_contentframe(!1),this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!1),$("tr",this.filters_list.list).each(function(){if("none"==this.style.display)return void $(this).detach();var e=this.id.substr(6);$(this).unbind(),e>i&&(this.uid=e-1,$(this).attr("id","rcmrow"+this.uid))}),a.init();break;case"update":var s,n=$("#rcmrow"+this.managesieve_rowid(t.id));t.name&&$("td",n).text(t.name),t.disabled?n.addClass("disabled"):n.removeClass("disabled"),$("#disabled",$("iframe").contents()).prop("checked",t.disabled);break;case"add":var a=this.filters_list,n=$('<tr><td class="name"></td></tr>');$("td",n).text(t.name),n.attr("id","rcmrow"+t.id),t.disabled&&n.addClass("disabled"),a.insert_row(n.get(0)),a.highlight_row(t.id),this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!0);break;case"list":var s,r,l,o,a=this.filters_list;t.clear&&a.clear();for(s in t.list)o=t.list[s],r=document.createElement("TR"),l=document.createElement("TD"),$(l).text(o.name),l.className="name",r.id="rcmrow"+o.id,o["class"]&&(r.className=o["class"]),r.appendChild(l),a.insert_row(r);t.set?a.highlight_row(t.set):this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!1);break;case"setact":var i=this.managesieve_setid(t.name),n=$("#rcmrow"+i);t.active?(t.all&&$("tr",this.gui_objects.filtersetslist).addClass("disabled"),n.removeClass("disabled")):n.addClass("disabled");break;case"setdel":var i=this.managesieve_setid(t.name);this.filtersets_list.remove_row(i),this.filters_list.clear(),this.show_contentframe(!1),this.enable_command("plugin.managesieve-setdel","plugin.managesieve-setact","plugin.managesieve-setget",!1),delete this.env.filtersets[i];break;case"setadd":var i="S"+(new Date).getTime(),a=this.filtersets_list,n=$('<tr class="disabled"><td class="name"></td></tr>');if($("td",n).text(t.name),n.attr("id","rcmrow"+i),this.env.filtersets[i]=t.name,a.insert_row(n.get(0)),t.index!=a.rowcount-1){n.detach();var c=$("tr:visible",a.list).get(t.index);n.insertBefore(c)}a.select(i),this.managesieve_fixdragend(n)}this.set_busy(!1)},rcube_webmail.prototype.load_managesieveframe=function(e){var t="undefined"!=typeof e&&null!=e;if(this.enable_command("plugin.managesieve-act","plugin.managesieve-del",t),this.env.contentframe&&window.frames&&window.frames[this.env.contentframe]){target=window.frames[this.env.contentframe];var i=this.set_busy(!0,"loading");target.location.href=this.env.comm_path+"&_action=plugin.managesieve-action&_framed=1"+(t?"&_fid="+e:"")+"&_unlock="+i}},rcube_webmail.prototype.managesieve_dragstart=function(){var e=this.filters_list.get_single_selection();this.drag_active=!0,this.drag_filter=e},rcube_webmail.prototype.managesieve_dragend=function(){if(this.drag_active){if(this.drag_filter_target){var e=this.set_busy(!0,"loading");this.show_contentframe(!1),this.http_post("plugin.managesieve-action","_act=move&_fid="+this.drag_filter+"&_to="+this.drag_filter_target,e)}this.drag_active=!1}},rcube_webmail.prototype.managesieve_fixdragend=function(e){var t=this;$(e).bind("mouseup"+(bw.iphone||bw.ipad?" touchend":""),function(e){t.drag_active&&t.filters_list.drag_mouse_up(e)})},rcube_webmail.prototype.managesieve_focus_filter=function(e){var t=e.id.replace(/^rcmrow/,"");this.drag_active&&t!=this.drag_filter&&(this.drag_filter_target=t,$(e.obj).addClass(t<this.drag_filter?"filtermoveup":"filtermovedown"))},rcube_webmail.prototype.managesieve_unfocus_filter=function(e){this.drag_active&&($(e.obj).removeClass("filtermoveup filtermovedown"),this.drag_filter_target=null)},rcube_webmail.prototype.managesieve_save=function(){if("plugin.managesieve-vacation"==this.env.action){var e=$(this.gui_objects.sieveform).serialize();return void this.http_post("plugin.managesieve-vacation",e,this.display_message(this.get_label("managesieve.vacation.saving"),"loading"))}if(parent.rcmail&&parent.rcmail.filters_list&&"filtersetform"!=this.gui_objects.sieveform.name){var t=parent.rcmail.filters_list.get_single_selection();null!=t&&(this.gui_objects.sieveform.elements._fid.value=parent.rcmail.filters_list.rows[t].uid)}this.gui_objects.sieveform.submit()},rcube_webmail.prototype.managesieve_ruleadd=function(e){this.http_post("plugin.managesieve-action","_act=ruleadd&_rid="+e)},rcube_webmail.prototype.managesieve_rulefill=function(e,t,i){if(""!=e){var a=document.getElementById("rules"),s=document.createElement("div");this.managesieve_insertrow(a,s,i),s.setAttribute("id","rulerow"+t),s.className="rulerow",s.innerHTML=e,$('textarea[data-type="list"]',s).each(function(){smart_field_init(this)}),this.managesieve_formbuttons(a)}},rcube_webmail.prototype.managesieve_ruledel=function(e){if(!$("#ruledel"+e).hasClass("disabled")&&confirm(this.get_label("managesieve.ruledeleteconfirm"))){var t=document.getElementById("rulerow"+e);t.parentNode.removeChild(t),this.managesieve_formbuttons(document.getElementById("rules"))}},rcube_webmail.prototype.managesieve_actionadd=function(e){this.http_post("plugin.managesieve-action","_act=actionadd&_aid="+e)},rcube_webmail.prototype.managesieve_actionfill=function(e,t,i){if(""!=e){var a=document.getElementById("actions"),s=document.createElement("div");this.managesieve_insertrow(a,s,i),s.className="actionrow",s.setAttribute("id","actionrow"+t),s.innerHTML=e,$('textarea[data-type="list"]',s).each(function(){smart_field_init(this)}),this.managesieve_formbuttons(a)}},rcube_webmail.prototype.managesieve_actiondel=function(e){if(!$("#actiondel"+e).hasClass("disabled")&&confirm(this.get_label("managesieve.actiondeleteconfirm"))){var t=document.getElementById("actionrow"+e);t.parentNode.removeChild(t),this.managesieve_formbuttons(document.getElementById("actions"))}},rcube_webmail.prototype.managesieve_insertrow=function(e,t,i){for(var a=0;a<e.childNodes.length&&e.childNodes[a].id!=("rules"==e.id?"rulerow":"actionrow")+i;a++);e.childNodes[a+1]?e.insertBefore(t,e.childNodes[a+1]):e.appendChild(t)},rcube_webmail.prototype.managesieve_formbuttons=function(e){var t,i,a=[];for(t=0;t<e.childNodes.length;t++)"rules"==e.id&&e.childNodes[t].id?/rulerow/.test(e.childNodes[t].id)&&a.push("ruledel"+e.childNodes[t].id.replace(/rulerow/,"")):e.childNodes[t].id&&/actionrow/.test(e.childNodes[t].id)&&a.push("actiondel"+e.childNodes[t].id.replace(/actionrow/,""));for(t=0;t<a.length;t++)i=document.getElementById(a[t]),t>0||a.length>1?$(i).removeClass("disabled"):$(i).addClass("disabled")},rcube_webmail.prototype.managesieve_vacation_addresses=function(e){var t=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action",{_act:"addresses",_aid:e},t)},rcube_webmail.prototype.managesieve_vacation_addresses_update=function(e,t){var i=$("#vacation_addresses,#action_addresses"+(e||""));smart_field_reset(i.get(0),t)},rcube_webmail.prototype.managesieve_tip_register=function(e){var t,i=parent.rcmail,a=i?parent.rcmail.env.ms_tip_layer:rcmail.env.ms_tip_layer;for(var t in e)$("#"+e[t][0]).data("tip",e[t][1]).bind("mouseenter",function(){var e=$(this),t=e.offset(),s=t.left,n=t.top-12,r=e.width();i&&(t=$("mail"==rcmail.env.task?"#sievefilterform > iframe":"#filter-box",parent.document).offset(),n+=t.top,s+=t.left),a.html(e.data("tip")),n-=a.height(),a.css({left:s,top:n,minWidth:r-2+"px"}).show()}).bind("mouseleave",function(){a.hide()})},rcube_webmail.prototype.managesieve_create=function(e){if(!e&&"show"!=this.env.action){var t=this.message_list.get_single_selection(),i=this.set_busy(!0,"loading");return void this.http_post("plugin.managesieve-action",{_uid:t},i)}if(this.env.sieve_headers&&this.env.sieve_headers.length){var a,s,n={},r=$("#sievefilterform");r.length||(r=$('<div id="sievefilterform"></div>'),$("body").append(r)),s="<fieldset><legend>"+this.gettext("managesieve.usedata")+"</legend><ul>";for(a in this.env.sieve_headers)s+='<li><input type="checkbox" name="headers[]" id="sievehdr'+a+'" value="'+a+'" checked="checked" /><label for="sievehdr'+a+'">'+this.env.sieve_headers[a][0]+":</label> "+this.env.sieve_headers[a][1]+"</li>";s+="</ul></fieldset>",r.html(s),n[this.gettext("managesieve.nextstep")]=function(){var e=$('input[name="headers[]"]:checked',r);if(!e.length)return void alert(rcmail.gettext("managesieve.nodata"));var t=rcmail.get_task_url("mail");t=rcmail.add_url(t,"_action","plugin.managesieve"),t=rcmail.add_url(t,"_framed",1),e.map(function(){var e=rcmail.env.sieve_headers[this.value];t=rcmail.add_url(t,"r["+this.value+"]",e[0]+":"+e[1])});var i=$("<iframe>").attr({src:t,frameborder:0});r.empty().append(i).dialog("widget").resize(),n={},n[rcmail.gettext("save")]=function(){var e=$("iframe",r).get(0).contentWindow;e.rcmail.managesieve_save()},r.dialog("option","buttons",n)},r.dialog({modal:!1,resizable:!0,closeOnEscape:!bw.ie7,title:this.gettext("managesieve.newfilter"),close:function(){rcmail.managesieve_dialog_close()},buttons:n,minWidth:600,minHeight:300,height:250}).show(),this.env.managesieve_dialog=r}},rcube_webmail.prototype.managesieve_dialog_close=function(){var e=this.env.managesieve_dialog;e.html(""),e.dialog("destroy").hide()},rcube_webmail.prototype.managesieve_dialog_resize=function(e){var t=this.env.managesieve_dialog,i=$(window),a=$(e);width=$("fieldset:first",e).width(),height=a.height(),w=i.width(),h=i.height(),t.dialog("option",{height:Math.min(h-20,height+120),width:Math.min(w-20,width+65)}).dialog("option","position",["center","center"])};